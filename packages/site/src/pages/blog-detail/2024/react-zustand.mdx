---
title: React çŠ¶æ€ç®¡ç†åº“ Â· Zustand
layout: blog
---

import WithoutSelector from "./demo/self-zustand/index.jsx";
import NormalUsage from "./demo/normal/index.jsx";
import InitFrame from "./demo/frame/index.jsx";

# React çŠ¶æ€ç®¡ç†åº“ Â· Zustand

## èµ·å› 

å·¥ä½œå¯¹æ¥ä¸­æ—§æœ‰é¡¹ç›®ä½¿ç”¨äº†`zustand`è¿™ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼Œä¸ºäº†å¢åŠ  å¯¹è¿™ä¸ªåº“çš„äº†è§£ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥è¿˜åŸå®ƒçš„æ ¸å¿ƒåŠŸèƒ½ã€‚

## ä½¿ç”¨

æˆ‘ä»¬å…ˆä½¿ç”¨`zustand`è¿™ä¸ªåº“ï¼Œä»¥ä¸‹ä¸ºæœ¬æ¬¡éœ€è¦å®ç°çš„ä¾‹å­ ğŸŒ°

ä»¥ä¸Šä½¿ç”¨`zustand`çš„ `create Api`ï¼Œ åŒæ—¶ç”¨äº† `selectors` è¿›è¡Œ `Render Optimization`ã€‚

### ç»“æœå±•ç¤º

<NormalUsage />

å¯ä»¥å°è¯•ç‚¹å‡»æŒ‰é’®ï¼ŒæŸ¥é˜…è°ƒè¯•å™¨(Devltools Console çª—å£)åˆå§‹åŒ–æ¸²æŸ“ä¼šè¾“å‡º `Zustand ClickButton render` å’Œ `Zustand CountCountry render`ã€‚å¦‚æœæœªä½¿ç”¨ `selectors`ï¼Œ åˆ™è¯¥ `counterStore` ä»»æ„æ›´æ–°ï¼Œéƒ½ä¼šè§¦å‘è°ƒç”¨è¯¥ `hooks` çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

å› ä¸ºå½“å‰ç¤ºä¾‹ä½¿ç”¨äº† `selectors` ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ›´æ–° `counterStore`çš„å…·ä½“å€¼çš„æ—¶å€™ï¼Œ åªæœ‰è¢«å¼•ç”¨çš„ç»„ä»¶æ‰ä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚

::: warning
`selectors` çš„ä½¿ç”¨æ–¹å¼éœ€è¦è¿”å›å…·ä½“çš„å±æ€§ï¼Œå¦‚æœè¿”å›çš„æ˜¯å¯¹è±¡ï¼Œå¹¶ä¸ä¼šè¿›è¡Œ `Render Optimization`ã€‚ ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š

```jsx
const { country, updateCountry } = useCounter((state) => ({
  country: state.country,
  updateCountry: state.updateCountry,
}));
```

å¦‚æœæƒ³å‡å°‘ `zustand selectors` çš„å†™æ³•ï¼Œå®˜æ–¹ä¹Ÿæœ‰å»ºè®®æ–¹å¼ï¼Œ[Auto Generating Selectors](https://docs.pmnd.rs/zustand/guides/auto-generating-selectors)
:::

## æ€è·¯

è®©æˆ‘ä»¬ä¸€èµ·æ¢³ç†ä¸‹ä½¿ç”¨æµç¨‹

![mind](../assets/zustand.png)

## å®ç°

æ ¹æ®ä»¥ä¸Šä½¿ç”¨é€»è¾‘ä»¥åŠå‚è€ƒæºç ï¼Œæˆ‘ä»¬ä» `Plain Usage` å’Œ `React Hooks Usage`

### Plain Usage

æˆ‘ä»¬å…ˆå®ç° Plain Usage çš„åœºæ™¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

#### ç»“æœå±•ç¤º

å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œå½“åªä½¿ç”¨ è®¢é˜… æ¨¡å¼ç›‘å¬æ•°æ®å˜åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•å®ç° è§†å›¾ å“åº”æ•ˆæœã€‚

<InitFrame />

### React Hooks Usage

å¦‚ä½•å®ç° `const count = useHookStore(state => state.count)` çš„æ•ˆæœå‘¢ï¼Ÿ

è¿™é‡Œä¸»è¦æ¶‰åŠåˆ°ä¸€ä¸ª `Api` å«åš [useSyncExternalStore](https://react.dev/reference/react/useSyncExternalStore)ï¼Œæˆ‘ä»¬é‡æ–°å®ç°å¤„ç†ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

#### ç»“æœå±•ç¤º

<WithoutSelector />

::: warning

ä»¥ä¸Šå·²ç»è¾¾åˆ°äº†ç±»ä¼¼ `Render Optimization` çš„æ•ˆæœï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰äº›é—®é¢˜ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°è¯•ä¸‹ä»¥ä¸‹ä½¿ç”¨æ–¹å¼:

```js
const { count, increaseCount } = useCounter((state) => ({
  count: state.count,
  increaseCount: state.increaseCount,
}));
```

ä¸Šè¿°é—®é¢˜æ˜¯ è¿”å›å€¼ä¸æ˜¯ä¸€ä¸ªå…·ä½“å­—æ®µï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡çš„åŸå› é€ æˆçš„ã€‚[useMutableSource â†’ useSyncExternalStore](https://github.com/reactwg/react-18/discussions/86) ä¸­ï¼ŒæåŠåˆ° `inline getSnapshot`ä½¿ç”¨æ–¹å¼å¦‚ä¸‹.

```js
// Selecting a specific field using an inline getSnapshot
const selectedField = useSyncExternalStore(
  store.subscribe,
  () => store.getSnapshot().selectedField,
);
```

:::

å®˜æ–¹ä¸ºäº†æ–¹ä¾¿èµ·è§å…¶å®ä¹Ÿæä¾›äº†å¦å¤–ä¸€ä¸ªåŒ… [use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store)è¿™ä¸ªåŒ…ã€‚

> As a convenience, we will provide a version of the API with automatic support for memoizing the result of getSnapshot:

```js
// Name of API is not final
import { useSyncExternalStoreWithSelector } from "use-sync-external-store/with-selector";
const selection = useSyncExternalStoreWithSelector(
  store.subscribe,
  store.getSnapshot,
  getServerSnapshot,
  selector,
  isEqual,
);
```

`zustand`ä¹Ÿæ˜¯ä½¿ç”¨äº†è¿™ä¸ªåŒ…ã€‚`useSyncExternalStoreWithSelector` å†…éƒ¨è°ƒç”¨äº† `useSyncExternalStore` æ–¹æ³•ï¼Œåªæ˜¯å†å¯¹ `getSnnapshot` åšäº†äº›é¢å¤–ä¼˜åŒ–å¤„ç†ï¼Œæœ‰éœ€è¦äº†è§£å¯è‡ªè¡Œå†å»æµè§ˆæºç ã€‚

## ä¼˜ç¼ºç‚¹

| æ–¹æ¡ˆ    | ä¼˜ç‚¹                                                                                                                                                                                  | ç¼ºç‚¹                                                                                                                                                                          |
| ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| zustand | ç›¸è¾ƒäº context ä½¿ç”¨æ›´ç®€å•ï¼Œè€Œä¸”é€‚ç”¨äº `many components throughout the tree`ï¼Œå¯ä»¥çœ‹è¿™ä¸ª [RFCS](https://github.com/reactjs/rfcs/blob/main/text/0147-use-mutable-source.md#context-api) | ç›®å‰ selector åªæ”¯æŒå…·ä½“æŸä¸ªå±æ€§ï¼Œæ‰‹åŠ¨å†™ä¼šæ¯”è¾ƒç¹çï¼Œéœ€è¦å†æä¾›ä¸ª `helper function` [Auto Generating Selectors](https://docs.pmnd.rs/zustand/guides/auto-generating-selectors) |
